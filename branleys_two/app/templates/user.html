{% extends "base.html" %}

{% block app_content %}
    <table class="table table-hover">
        <tr>
            <td width="256px">
                <img id="avatar" src="{{ url_for('static', filename='img/emptyavatar.png') }}" width="400px">

                <!--
                <img src="{{ user.avatar(256) }}" onerror="this.src='{{ url_for('static', filename='img/emptyavatar.png') }}'">
                -->
            </td>
            <td>
                <h1>User: {{ user.username }}</h1>
                {% if user.about_me %}<p>{{ user.about_me }}</p>{% endif %}
                {% if user.last_seen %}
                <p>Last seen on: {{ moment(user.last_seen).format('LLL') }}</p>
                {% endif %}
                {% if user.username == current_user %}
                <p><a href="{{ url_for('edit_profile') }}">Edit your profile</a></p>
                {% endif %}
            </td>
        </tr>
    </table>

    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script>
        console.log("User page loaded!");
        $("<img/>")
            .on('load', function() {
                // image loaded correctly so replace blank avatar
                $("#avatar").attr("src", "{{ user.avatar(256) }}");
                })
            .on('error', function() { console.log("cannot reach gravatar"); })
            .attr("src", "{{ user.avatar(256) }}");
    </script>


    {% if posts %}
        <div class="divider">
            <h1>Look at the change you are bringing!</h1>
        </div>

        <p>So far you have started {{posts|length}} campaigns. Look at what you have brought.</p>

        {% for post in posts %}
            {% include '_post.html' %}
        {% endfor %}

    {% else %}

        <div class="divider">
            <h1>You have not started any campaigns</h1>
        </div>

        <p>Scratch your niche by starting a new campaign</p>

    {% endif%}


    <nav aria-label="...">
        <ul class="pager">
            <li class="previous{% if not prev_url %} disabled{% endif %}">
                <a href="{{ prev_url or '#' }}">
                    <span aria-hidden="true">&larr;</span> Your Newer Campaigns
                </a>
            </li>
            <li class="next{% if not next_url %} disabled{% endif %}">
                <a href="{{ next_url or '#' }}">
                    Your Older Campaigns <span aria-hidden="true">&rarr;</span>
                </a>
            </li>
        </ul>
    </nav>
{% endblock %}
